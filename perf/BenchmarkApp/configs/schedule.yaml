# template: https://github.com/Cysharp/Actions/tree/main/.github/scripts/_template_benchmark_config.yaml
# config2args script: https://github.com/Cysharp/Actions/tree/main/.github/scripts/benchmark_config2args.sh
apt-tools: "libmsquic"
dotnet-version: 8.0
benchmark-expire-min: 15
benchmark-location: "japaneast"
benchmark-timeout-min: 10
benchmark-client-run-script-path: ".github/scripts/benchmark-client-run.sh"
benchmark-client-run-script-args: '--run-args "-u http://${BENCHMARK_SERVER_NAME}:5000 --protocol {{ protocol }} -s CI --rounds 3 --channels {{ channels }} --streams {{ streams }} --serialization {{ serialization }} --validate true --tags {{ tags }}" --build-args "{{ buildArgsClient }}"'
benchmark-server-run-script-path: ".github/scripts/benchmark-server-run.sh"
benchmark-server-run-script-args: '--run-args "-u http://0.0.0.0:5000 --protocol {{ protocol }} --serialization {{ serialization }} --validate true --tags {{ tags }}" --build-args "{{ buildArgsServer }}"'
benchmark-server-stop-script-path: ".github/scripts/benchmark-server-stop.sh"
jobs:
  ##### MessagePack #####
  # h2c
  - tags: legend:messagepack-h2c-linux,streams:1x1,protocol:h2c,serialization:messagepack
    protocol: h2c
    channels: 1
    streams: 1
    serialization: messagepack
  - tags: legend:messagepack-h2c-linux,streams:1x28,protocol:h2c,serialization:messagepack
    protocol: h2c
    channels: 28
    streams: 1
    serialization: messagepack
  - tags: legend:messagepack-h2c-linux,streams:28x1,protocol:h2c,serialization:messagepack
    protocol: h2c
    channels: 1
    streams: 28
    serialization: messagepack
  - tags: legend:messagepack-h2c-linux,streams:70x1,protocol:h2c,serialization:messagepack
    protocol: h2c
    channels: 1
    streams: 70
    serialization: messagepack
  - tags: legend:messagepack-h2c-linux,streams:70x28,protocol:h2c,serialization:messagepack
    protocol: h2c
    channels: 28
    streams: 70
    serialization: messagepack
  # h2
  - tags: legend:messagepack-h2-linux,streams:1x1,protocol:h2,serialization:messagepack
    protocol: h2
    channels: 1
    streams: 1
    serialization: messagepack
  - tags: legend:messagepack-h2-linux,streams:1x28,protocol:h2,serialization:messagepack
    protocol: h2
    channels: 28
    streams: 1
    serialization: messagepack
  - tags: legend:messagepack-h2-linux,streams:28x1,protocol:h2,serialization:messagepack
    protocol: h2
    channels: 1
    streams: 28
    serialization: messagepack
  - tags: legend:messagepack-h2-linux,streams:70x1,protocol:h2,serialization:messagepack
    protocol: h2
    channels: 1
    streams: 70
    serialization: messagepack
  - tags: legend:messagepack-h2-linux,streams:70x28,protocol:h2,serialization:messagepack
    protocol: h2
    channels: 28
    streams: 70
    serialization: messagepack
  # h3
  - tags: legend:messagepack-h3-linux,streams:1x1,protocol:h3,serialization:messagepack
    protocol: h3
    channels: 1
    streams: 1
    serialization: messagepack
  - tags: legend:messagepack-h3-linux,streams:1x28,protocol:h3,serialization:messagepack
    protocol: h3
    channels: 28
    streams: 1
    serialization: messagepack
  - tags: legend:messagepack-h3-linux,streams:28x1,protocol:h3,serialization:messagepack
    protocol: h3
    channels: 1
    streams: 28
    serialization: messagepack
  - tags: legend:messagepack-h3-linux,streams:70x1,protocol:h3,serialization:messagepack
    protocol: h3
    channels: 1
    streams: 70
    serialization: messagepack
  - tags: legend:messagepack-h3-linux,streams:70x28,protocol:h3,serialization:messagepack
    protocol: h3
    channels: 28
    streams: 70
    serialization: messagepack
  ##### MemoryPack #####
  # h2c
  - tags: legend:memorypack-h2c-linux,streams:1x1,protocol:h2c,serialization:memorypack
    protocol: h2c
    channels: 1
    streams: 1
    serialization: memorypack
  - tags: legend:memorypack-h2c-linux,streams:1x28,protocol:h2c,serialization:memorypack
    protocol: h2c
    channels: 28
    streams: 1
    serialization: memorypack
  - tags: legend:memorypack-h2c-linux,streams:28x1,protocol:h2c,serialization:memorypack
    protocol: h2c
    channels: 1
    streams: 28
    serialization: memorypack
  - tags: legend:memorypack-h2c-linux,streams:70x1,protocol:h2c,serialization:memorypack
    protocol: h2c
    channels: 1
    streams: 70
    serialization: memorypack
  - tags: legend:memorypack-h2c-linux,streams:70x28,protocol:h2c,serialization:memorypack
    protocol: h2c
    channels: 28
    streams: 70
    serialization: memorypack
  # h2
  - tags: legend:memorypack-h2-linux,streams:1x1,protocol:h2,serialization:memorypack
    protocol: h2
    channels: 1
    streams: 1
    serialization: memorypack
  - tags: legend:memorypack-h2-linux,streams:1x28,protocol:h2,serialization:memorypack
    protocol: h2
    channels: 28
    streams: 1
    serialization: memorypack
  - tags: legend:memorypack-h2-linux,streams:28x1,protocol:h2,serialization:memorypack
    protocol: h2
    channels: 1
    streams: 28
    serialization: memorypack
  - tags: legend:memorypack-h2-linux,streams:70x1,protocol:h2,serialization:memorypack
    protocol: h2
    channels: 1
    streams: 70
    serialization: memorypack
  - tags: legend:memorypack-h2-linux,streams:70x28,protocol:h2,serialization:memorypack
    protocol: h2
    channels: 28
    streams: 70
    serialization: memorypack
  # h3
  - tags: legend:memorypack-h3-linux,streams:1x1,protocol:h3,serialization:memorypack
    protocol: h3
    channels: 1
    streams: 1
    serialization: memorypack
  - tags: legend:memorypack-h3-linux,streams:1x28,protocol:h3,serialization:memorypack
    protocol: h3
    channels: 28
    streams: 1
    serialization: memorypack
  - tags: legend:memorypack-h3-linux,streams:28x1,protocol:h3,serialization:memorypack
    protocol: h3
    channels: 1
    streams: 28
    serialization: memorypack
  - tags: legend:memorypack-h3-linux,streams:70x1,protocol:h3,serialization:memorypack
    protocol: h3
    channels: 1
    streams: 70
    serialization: memorypack
  - tags: legend:memorypack-h3-linux,streams:70x28,protocol:h3,serialization:memorypack
    protocol: h3
    channels: 28
    streams: 70
    serialization: memorypack
  ##### Fixed ClientVersion #####
  # h2c
  - tags: legend:messagepack-h2c-linux,streams:1x1,protocol:h2c,serialization:messagepack
    protocol: h2c
    channels: 1
    streams: 1
    serialization: messagepack
    buildArgsClient: --p:UseNuGetClient=6.1.4
  - tags: legend:messagepack-h2c-linux,streams:1x28,protocol:h2c,serialization:messagepack
    protocol: h2c
    channels: 28
    streams: 1
    serialization: messagepack
    buildArgsClient: --p:UseNuGetClient=6.1.4
  - tags: legend:messagepack-h2c-linux,streams:28x1,protocol:h2c,serialization:messagepack
    protocol: h2c
    channels: 1
    streams: 28
    serialization: messagepack
    buildArgsClient: --p:UseNuGetClient=6.1.4
  - tags: legend:messagepack-h2c-linux,streams:70x1,protocol:h2c,serialization:messagepack
    protocol: h2c
    channels: 1
    streams: 70
    serialization: messagepack
    buildArgsClient: --p:UseNuGetClient=6.1.4
  - tags: legend:messagepack-h2c-linux,streams:70x28,protocol:h2c,serialization:messagepack
    protocol: h2c
    channels: 28
    streams: 70
    serialization: messagepack
    buildArgsClient: --p:UseNuGetClient=6.1.4
  ##### Fixed ServerVersion #####
  # h2c
  - tags: legend:messagepack-h2c-linux,streams:1x1,protocol:h2c,serialization:messagepack
    protocol: h2c
    channels: 1
    streams: 1
    serialization: messagepack
    buildArgsServer: --p:UseNuGetServer=6.1.4
  - tags: legend:messagepack-h2c-linux,streams:1x28,protocol:h2c,serialization:messagepack
    protocol: h2c
    channels: 28
    streams: 1
    serialization: messagepack
    buildArgsServer: --p:UseNuGetServer=6.1.4
  - tags: legend:messagepack-h2c-linux,streams:28x1,protocol:h2c,serialization:messagepack
    protocol: h2c
    channels: 1
    streams: 28
    serialization: messagepack
    buildArgsServer: --p:UseNuGetServer=6.1.4
  - tags: legend:messagepack-h2c-linux,streams:70x1,protocol:h2c,serialization:messagepack
    protocol: h2c
    channels: 1
    streams: 70
    serialization: messagepack
    buildArgsServer: --p:UseNuGetServer=6.1.4
  - tags: legend:messagepack-h2c-linux,streams:70x28,protocol:h2c,serialization:messagepack
    protocol: h2c
    channels: 28
    streams: 70
    serialization: messagepack
    buildArgsServer: --p:UseNuGetServer=6.1.4
